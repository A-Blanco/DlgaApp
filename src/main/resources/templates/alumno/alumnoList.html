<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<object th:replace="recursos/base :: boot"></object>
<link rel="stylesheet" th:href="@{/estilos/base.css}" />
<script onselect="filtro" type="text/javascript">
	$(document).ready(function() {
		$('#alumnoList').DataTable({
			"responsive" : true,
			"language" : idioma,
			"destroy" : true,
			"searching" : false,

		}).draw(true).columns.adjust();
	});

	function decideFiltro(val) {

		if (val == "nombre") {
			$(document).ready(function() {
				$('#alumnoList').DataTable({
					"responsive" : true,
					"language" : idioma,
					"destroy" : true,
					"columnDefs" :

					[ {
						"searchable" : false,
						"targets" : 1
					}, {
						"searchable" : false,
						"targets" : 2
					},

					]

				}).draw(true).columns.adjust();
			});
		}

		else if (val == "email") {
			$(document).ready(function() {
				$('#alumnoList').DataTable({
					"responsive" : true,
					"language" : idioma,
					"destroy" : true,
					"columnDefs" :

					[ {
						"searchable" : false,
						"targets" : 0
					}, {
						"searchable" : false,
						"targets" : 2
					},

					]

				}).draw(true).columns.adjust();
			});
		}
	}
</script>

<script type="text/javascript">
$( document ).ready(function() {
	

	  
	  var alumno = "[[${alumnoSeleccionado}]]";
	  var error = 1;
	  
	  if(alumno!=""){
		  $('#ModalAlumnoUpdate').modal()
	  }
	  if (error ==1){
		  
		  $('#ModalAlumnoUpdate').modal('dispose')
		   $('#ModalAlumnoUpdate').modal()
	  }
	
})


</script>

<script th:replace="recursos/idiomaTable :: idiomaTable" type="text/javascript"></script>
</head>
<body>
<header th:replace="recursos/base :: navbar"></header>
	<h2>Lista de Alumnos</h2>
	
	<div class="col-md-4 ml-auto" >
				<select title="Filtrar: " onchange="decideFiltro(this.value)" id="selectFiltro"
					name="filtro">
					<option disabled selected>Filtros de Búsqueda</option>
					<option value="nombre" id="selectNombre">Nombre</option>
					<option value="email" id="selectId">Email</option>
				</select>
				</div>

<div class="container">
		<div class="mx-auto">
			<div class="table-responsive">
				<table id="alumnoList" class="table table-bordered table-hover table-striped">
					<thead class="thead-light">
			<tr>
				<th>Nombre</th>
				<th>Email</th>
				<th  th:if="${#session.getAttribute('grupoId') != null}"></th>
				<th sec:authorize="hasRole('ADMIN')" th:if="${#session.getAttribute('grupoId') == null}"></th>
				<th sec:authorize="hasRole('ADMIN')" th:if="${#session.getAttribute('grupoId') == null}"></th>
				<th></th>
			</tr>
		</thead>
		<tbody>

			<tr th:each="alumno : ${alumnos}">
				<td th:text="${alumno.nombre}"></td>
				<td th:text="${alumno.email}"></td>
				<td th:if="${#session.getAttribute('grupoId') != null}"><a th:if="${ alumno.grupoDelegado == null}"
					th:href="@{/agregarDelegado/} + ${alumno.id}">Añadir</a>
					<p th:if="${ alumno.grupoDelegado != null}">Este Alumno ya es
						delegado de un grupo</p></td>
				
				<td sec:authorize="hasRole('ADMIN')" th:if="${#session.getAttribute('grupoId') == null}">
				<form th:action="@{alumnoUpdate}"  method="get">
				<input type="hidden" th:value="${alumno.id}" name="alumnoId"></input>
				<button type="submit" class="btn btn-primary">Modificar datos</button>
				</form>
				
				</td>
 
 
					<td sec:authorize="hasRole('ADMIN')" th:if="${#session.getAttribute('grupoId') == null}"><a 
					th:href="@{/alumnoDelete/} + ${alumno.id}">Eliminar</a></td>
				<td><a
					th:href="@{/detallesAlumno/} + ${alumno.id}">Ver detalles Alumno</a></td>
			</tr>

		</tbody>
	</table>
	</div>
	</div>
	</div>

<a class="btn btn-primary" sec:authorize="hasAnyRole('ADMIN', 'DEVELOPER')" th:if="${#session.getAttribute('grupoId') == null}" 
th:href="@{/crearAlumno} ">Crear Alumno</a>



<div th:if="${alumnoSeleccionado != null}" class="modal fade" th:id="ModalAlumnoUpdate" tabindex="-1"
		role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="ModalTitle">Editar Alumno</h5>
					
						
				</div>
				<form id="formUpdate" class="col-12" th:object="${alumnoSeleccionado}"  th:action="@{alumnoUpdate}"  method="post">
                     
                      <input th:field="*{id}" type="hidden"  name="id"/>
                     
                     <div class="form-group" id="nombre-group">
                     
                        <input th:field="*{nombre}" type="text" class="form-control" placeholder="Nombre del alumno" name="nombre"/>
                       <p class="alert alert-danger" role="alert" th:errors="*{nombre}"></p>
                    </div>
                    <div class="form-group" id="apellidos-group">
                    
                        <input th:field="*{apellidos}" type="text" class="form-control" placeholder="Apellidos" name="apellidos">
                  		<p class="alert alert-danger" role="alert" th:errors="*{apellidos}"></p>
                    </div>
                    <div class="form-group" id="edad-group">
                        <input th:field="*{edad}" type="number" class="form-control" placeholder="Edad" name="edad"/>
                        <p class="alert alert-danger" role="alert" th:errors="*{edad}"></p>
                    </div>
                    <div class="form-group" id="email-group">
                        <input th:field="*{email}" type="text" class="form-control" placeholder="Email" name="email"/>
                        <p class="alert alert-danger" role="alert" th:errors="*{email}"></p>
                    </div>
                    <div class="modal-footer">
                    
						<a th:href="@{/listAlumnos}" class="btn btn-secondary">Cerrar</a>
						<button type="submit" class="btn btn-primary">Actualizar</button>
					</div>
                </form>
			</div>
		</div>
	</div>
    
</body>
</html>