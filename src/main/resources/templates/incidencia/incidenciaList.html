<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<object th:replace="recursos/base :: boot"></object>
<link rel="stylesheet" th:href="@{/estilos/base.css}" />
<script onselect="filtro" type="text/javascript">
	$(document).ready(function() {
		$('#incidenciaList').DataTable({
			"responsive" : true,
			"language" : idioma,
			"destroy" : true,
			"searching" : false,

		}).draw(true).columns.adjust();
	});

	function decideFiltro(val) {

		
		if (val == "id") {
			$(document).ready(function() {
				$('#incidenciaList').DataTable({
					"responsive" : true,
					"language" : idioma,
					"destroy" : true,
					"columnDefs" :

					[ {
						"searchable" : false,
						"targets" : 1
					}, {
						"searchable" : false,
						"targets" : 2
					},
					{
						"searchable" : false,
						"targets" : 3
					},
					{
						"searchable" : false,
						"targets" : 4
					},
					{
						"searchable" : false,
						"targets" : 5
					},
					{
						"searchable" : false,
						"targets" : 6
					},

					]

				}).draw(true).columns.adjust();
			});
		}
		
		
		if (val == "alumno") {
			$(document).ready(function() {
				$('#incidenciaList').DataTable({
					"responsive" : true,
					"language" : idioma,
					"destroy" : true,
					"columnDefs" :

					[ {
						"searchable" : false,
						"targets" : 0
					}, {
						"searchable" : false,
						"targets" : 1
					},
					{
						"searchable" : false,
						"targets" : 3
					},
					{
						"searchable" : false,
						"targets" : 4
					},
					{
						"searchable" : false,
						"targets" : 5
					},
					{
						"searchable" : false,
						"targets" : 6
					},

					]

				}).draw(true).columns.adjust();
			});
		}
		

		if (val == "profesor") {
			$(document).ready(function() {
				$('#incidenciaList').DataTable({
					"responsive" : true,
					"language" : idioma,
					"destroy" : true,
					"columnDefs" :

					[ {
						"searchable" : false,
						"targets" : 0
					}, {
						"searchable" : false,
						"targets" : 1
					},
					{
						"searchable" : false,
						"targets" : 2
					},
					{
						"searchable" : false,
						"targets" : 4
					},
					{
						"searchable" : false,
						"targets" : 5
					},
					{
						"searchable" : false,
						"targets" : 6
					},

					]

				}).draw(true).columns.adjust();
			});
		}
		
		if (val == "asignatura") {
			$(document).ready(function() {
				$('#incidenciaList').DataTable({
					"responsive" : true,
					"language" : idioma,
					"destroy" : true,
					"columnDefs" :

					[ {
						"searchable" : false,
						"targets" : 0
					}, {
						"searchable" : false,
						"targets" : 1
					},
					{
						"searchable" : false,
						"targets" : 2
					},
					{
						"searchable" : false,
						"targets" : 3
					},
					{
						"searchable" : false,
						"targets" : 5
					},
					{
						"searchable" : false,
						"targets" : 6
					},

					]

				}).draw(true).columns.adjust();
			});
		}
		
		if (val == "estado") {
			$(document).ready(function() {
				$('#incidenciaList').DataTable({
					"responsive" : true,
					"language" : idioma,
					"destroy" : true,
					"columnDefs" :

					[ {
						"searchable" : false,
						"targets" : 0
					}, {
						"searchable" : false,
						"targets" : 1
					},
					{
						"searchable" : false,
						"targets" : 2
					},
					{
						"searchable" : false,
						"targets" : 3
					},
					{
						"searchable" : false,
						"targets" : 4
					},
					{
						"searchable" : false,
						"targets" : 6
					},

					]

				}).draw(true).columns.adjust();
			});
		}
		
		
		
	}
</script>
<script type="text/javascript">
$( document ).ready(function() {
	

	  
	  var incidenciaIdDelete = "[[${incidenciaIdDelete}]]";
	  
	  if(incidenciaIdDelete!=""){
		  $('#ModalIncidenciaDelete').modal()
	  }
	 
})
</script>
<script th:replace="recursos/idiomaTable :: idiomaTable" type="text/javascript"></script>
</head>
<body>
<header th:replace="recursos/base :: navbar"></header>
	<h2>Lista de Incidencia</h2>
	
	<div class="col-md-4 ml-auto">
		<select title="Filtrar: " onchange="decideFiltro(this.value)"
			id="selectFiltro" name="filtro">
			<option disabled selected>Filtros de Búsqueda</option>
			<option value="id" id="selectId">Id</option>
			<option value="alumno" id="selectAlumno">Alumno</option>
			<option value="profesor" id="selectProfesor">Profesor</option>
			<option value="asignatura" id="selectAsignatura">Asignatura</option>
			<option value="estado" id="selectEstado">Estado</option>
		</select>
	</div>

<div class="container">
		<div class="mx-auto">
			<div class="table-responsive">
				<table id="incidenciaList" class="table table-bordered table-hover table-striped">
					<thead class="thead-light">
			<tr>
				<th>Id</th>
				<th>Fecha Creación</th>
				<th>Alumno</th>
				<th>Profesor</th>
				<th>Asignatura</th>
				<th>Estado</th>
				<th></th>
				<th sec:authorize="hasRole('ADMIN')"></th>
			</tr>
		</thead>
		<tbody>

			<tr th:each="incidencia : ${incidencias}">
				<td th:text="${incidencia.id}"></td>
				<td th:text="${incidencia.fechaCreacion}"></td>
				<td th:text="${incidencia.alumno.nombre + ' ' + incidencia.alumno.apellidos }"></td>
				<td th:text="${incidencia.profesor.nombre}"></td>
				<td th:text="${incidencia.asignatura.nombre}"></td>
				<td th:text="${incidencia.estado}"></td>
				<td><a
					 class="btn btn-dark"  th:href="@{/detallesIncidencia/} + ${incidencia.id}">Ver detalles Incidencia</a></td>	
					 
				<td sec:authorize="hasRole('ADMIN')"><a class="btn btn-danger"
								th:href="@{/incidenciaDeleteSeguridad/} + ${incidencia.id}">Eliminar</a></td>	 	
			</tr>

		</tbody>
	</table>
	</div>
	</div>
	</div>


<div class="modal fade" th:id="ModalIncidenciaDelete" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ModalTitle">Aviso Importante</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
       
      <div class="modal-body">
       
          <div >
            <p>Usted va a eliminar los datos de la incidencia seleccionada, esto conlleva la eliminación de ciertos datos relacionados con la incidencia.
            ¿Está segur@?
            </p>
          </div>
        
      </div>
      <div class="modal-footer">
       <a  th:href="@{/gestionIncidencias}" class="btn btn-secondary">Cerrar</a>
       <a  th:href="@{/incidenciaDelete/} + ${incidenciaIdDelete}" class="btn btn-danger">Eliminar</a>
      </div>
      
       </div>
  </div>
</div>   

</body>
</html>